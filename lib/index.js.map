{"version":3,"file":"index.js","sources":["../src/compile/index.js","../src/index.js"],"sourcesContent":["/*\n * @Author: haorongzheng\n * @Date: 2020-11-25 17:18:41\n * @LastEditTime: 2022-01-02 15:17:35\n * @LastEditors: haorongzheng\n * @Description: 自定义解析操作\n * @FilePath: /single-jsx/src/compile/index.js\n * @保佑代码永无bug\n */\n// 把创建的对象转为真实DOM元素最后插入到页面中\nclass Component {\n  static isReactComponent = true;\n  constructor(props) {\n    this.props = props;\n  }\n}\n\nconst hasSymbol = typeof Symbol === \"function\" && Symbol.for; // 浏览器是否支持 Symbol\n// 支持Symbol的话，就创建一个Symbol类型的标识，否则就以二进制 0xeac7代替。\n// 为什么是 Symbol？主要防止xss攻击伪造一个fake的react组件。因为json中是不会存在symbol的.\n// 为什么是 二进制 0xeac7 ？因为 0xeac7 和单词 React长得很像。\nconst REACT_ELEMENT_TYPE = hasSymbol ? Symbol.for(\"react.element\") : 0xeac7;\n\nfunction ReactElement(type, props) {\n  return {\n    typeof: REACT_ELEMENT_TYPE,\n    type,\n    props,\n  };\n}\n\nexport function createElement(type, config, children) {\n  const props = {};\n\n  for (let propName in config) {\n    // 如果对象本身存在该属性值，就copy\n    if (Object.prototype.hasOwnProperty.call(config, propName)) {\n      props[propName] = config[propName];\n    }\n  }\n\n  const childrenLength = arguments.length - 2;\n\n  if (childrenLength === 1) {\n    props.children = children;\n  } else if (childrenLength > 1) {\n    // 1. React 官方实现，声明一个和childrenLength一样长的数组\n    // 然后遍历 arguments对象，把第二个之后的参数项给 childrenArray\n    // let childrenArray = Array(childrenLength);\n    // for (let i = 0; i < arguments.length; i++) {\n    //     childrenArray[i] = arguments[i + 2]\n    // }\n    // props.children = childrenArray;\n\n    // 2. 数组slice截取，截取第二个之后所有的参数项给props.children\n    props.children = Array.prototype.slice.call(arguments, 2);\n  }\n  return ReactElement(type, props);\n}\n\nexport function render(node, mountNode) {\n  if (!node) return;\n  if (typeof node === \"string\") {\n    return mountNode.append(document.createTextNode(node));\n  }\n  let type = node.type;\n  let props = node.props;\n  if (node instanceof Array) {\n    return node.forEach((child) => {\n      return render(child, mountNode);\n    });\n  }\n  while (typeof type === \"function\") {\n    let element = type(props);\n    props = element.props;\n    type = element.type;\n  }\n  if (type && type.isReactComponent) {\n    let element = new type(props).render();\n    props = element.props;\n    type = element.type;\n  }\n  let domElement = document.createElement(type);\n  for (let propName in props) {\n    if (propName === \"children\") {\n      let children = props[propName];\n      children = Array.isArray(children) ? children : [children];\n      children.forEach((child) => render(child, domElement));\n    } else if (propName === \"style\") {\n      let styleObj = props[propName];\n      if (typeof styleObj === \"string\") {\n        domElement.style = styleObj;\n      } else {\n        for (let attr in styleObj) {\n          domElement.style[attr] = styleObj[attr];\n        }\n      }\n    } else if (propName === \"class\" || propName === \"className\") {\n      domElement.setAttribute(\"class\", props[propName]);\n    } else if (/^on/.test(propName)) {\n      const event = propName.replace(/on/, \"\").toLocaleLowerCase();\n      domElement.addEventListener(event, props[propName], false);\n    } else if (propName.toLowerCase() == \"innerhtml\") {\n      domElement.innerHTML = props[propName].toString();\n    } else if (propName === \"dangerouslySetInnerHTML\") {\n      if (props[propName] && props[propName].__html) {\n        domElement.innerHTML = props[propName].__html.toString();\n      }\n    } else if (propName === \"ref\") {\n      const refReal = props[propName];\n      if (!refReal instanceof Ref) throw new Error(\"ref必须为Ref实例\");\n      refReal.set(\"current\", domElement);\n    } else if (propName === \"key\") {\n      // key相关处理\n      // TODO\n    } else {\n      domElement.setAttribute(propName, props[propName]);\n    }\n  }\n  mountNode.appendChild(domElement);\n}\n\nexport function useEffect(callback, dependencies = []) {\n  // useEffect待实现\n  if (typeof callback !== \"function\") throw new Error(\"useEffect类型错误\");\n  if (!(dependencies instanceof Array)) throw new Error(\"依赖项必须为数组\");\n  if (dependencies.length === 0) {\n    setTimeout(callback, 0);\n  } else {\n    // 有依赖项处理\n  }\n}\n\nclass Ref {\n  constructor(value) {\n    this.current = value;\n  }\n  //this should be triggered when form.something\n  get(property) {\n    return this[property];\n  }\n\n  //this should be triggered when from.something = 'something'\n  set(property, value) {\n    return (this[property] = value);\n  }\n}\n\nexport function createRef(value = null) {\n  const ref = new Ref(value);\n  return ref;\n}\n\nexport default {\n  createElement,\n  useEffect,\n  Component,\n  createRef,\n  render,\n};\n","/*\n * @Author: haorongzheng\n * @Date: 2022-01-02 15:15:24\n * @LastEditTime: 2022-01-02 15:29:21\n * @LastEditors: haorongzheng\n * @Description: 测试\n * @FilePath: /single-jsx/src/index.js\n * 保佑代码永无bug\n */\nimport React,{render,createRef,useEffect} from './compile';\nconst Ref = () => {  // ref\n    const ref = createRef();\n    useEffect(()=> {\n        console.log(ref.current);\n    },[])\n    return <div ref={ref}></div>\n};\nconst Style = (props) => { // style解析\n    const {children} = props;\n    return <div style={{height: '100px'}}>{children}</div>\n}\nconst Test = () => { // jsx解析\n    return <div>测试</div>\n}\nconst Dom =() => {\n    return <div><Test />12312<Ref /><Style>内容</Style></div>\n}\n\nconst Index = () => {\n    render(<Dom />,document.body)\n}\n\nexport default Index\n"],"names":["Component","props","isReactComponent","hasSymbol","Symbol","REACT_ELEMENT_TYPE","ReactElement","type","createElement","config","children","propName","Object","prototype","hasOwnProperty","call","childrenLength","arguments","length","Array","slice","render","node","mountNode","append","document","createTextNode","forEach","child","element","domElement","isArray","styleObj","style","attr","setAttribute","test","event","replace","toLocaleLowerCase","addEventListener","toLowerCase","innerHTML","toString","__html","refReal","Ref","Error","set","appendChild","useEffect","callback","dependencies","setTimeout","value","current","get","property","createRef","ref","console","log","Style","height","Test","Dom","Index","body"],"mappings":"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"}